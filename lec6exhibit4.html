<!DOCTYPE html>
<!-- saved from url=(0079)http://www.cs.cornell.edu/courses/cs4620/2019fa/cs4621/lecture06/exhibit04.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>CS 4621: Lecture 6 -- Exhibit #4: Chaining 3D Transformations</title>

    <!-- Bootstrap -->
    <link href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/bootstrap.min.css"
        rel="stylesheet">
    <link href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/cs4620.css" rel="stylesheet">
    <link href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/jquery-ui.min.css"
        rel="stylesheet">
    <link href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/jquery-ui.theme.min.css"
        rel="stylesheet">
    <link href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/jquery-ui.structure.min.css"
        rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css"
        href="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/prettify.css">
</head>

<body>
    <div class="container">
        <h1>Exhibit 1 <span class="subtitle">Chaining 3D Transformations</span></h1>

        <div class="center-block">
            <canvas id="objCanvas" style="border: none; background-color: black;" width="500" height="500"></canvas>
            <canvas id="worldCanvas" style="border: none; background-color: black;" width="500" height="500"></canvas>
        </div>

        <table class="table table-bordered">
            <tbody>
                <tr>
                    <td colspan="4" align="center"><b>Transformation</b></td>
                </tr>
                <tr>
                    <td>
                        Translation:
                    </td>
                    <td>
                        X = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="transX" value="0.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="0"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Y = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="transY" value="0.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="0"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Z = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="transZ" value="0.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="0"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        <table id="transMatrix" class="matrix">
                            <tbody>
                                <tr>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        Rotation:
                    </td>
                    <td>
                        X angle = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="rotX" value="0.0" aria-valuemin="-360" aria-valuemax="360" aria-valuenow="-50"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Y angle = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="rotY" value="0.0" aria-valuemin="-360" aria-valuemax="360" aria-valuenow="210"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Z angle = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="rotZ" value="0.0" aria-valuemin="-360" aria-valuemax="360" aria-valuenow="55"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        <table id="rotMatrix" class="matrix">
                            <tbody>
                                <tr>
                                    <td>-0.497</td>
                                    <td>0.709</td>
                                    <td>-0.500</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.746</td>
                                    <td>0.055</td>
                                    <td>-0.663</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>-0.443</td>
                                    <td>-0.703</td>
                                    <td>-0.557</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        Scale:
                    </td>
                    <td>
                        X = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="scaleX" value="1.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="1"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Y = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="scaleY" value="1.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="1"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        Z = <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input type="text"
                                id="scaleZ" value="1.0" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="1"
                                autocomplete="off" class="ui-spinner-input" role="spinbutton"><a tabindex="-1"
                                aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span
                                    class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true"
                                class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only"
                                role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span
                                    class="ui-button-icon-space"> </span></a></span>
                    </td>
                    <td>
                        <table id="scaleMatrix" class="matrix">
                            <tbody>
                                <tr>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        Compound Transformation:
                    </td>
                    <td>
                        <fieldset>
                            <legend>Composition order: </legend>
                            <label for="orderTRS">TRS</label>
                            <input type="radio" name="comp-order" id="orderTRS" checked="true">
                            <label for="orderSRT">SRT</label>
                            <input type="radio" name="comp-order" id="orderSRT">
                        </fieldset>
                    </td>
                    <td>
                        <fieldset>
                            <legend>Rotation order: </legend>
                            <label for="orderXYZ">XYZ</label>
                            <input type="radio" name="rot-order" id="orderXYZ" checked="true">
                            <label for="orderZYX">ZYX</label>
                            <input type="radio" name="rot-order" id="orderZYX">
                        </fieldset>
                    </td>
                    <td>
                    </td>
                    <td>
                        <table id="compMatrix" class="matrix">
                            <tbody>
                                <tr>
                                    <td>-0.497</td>
                                    <td>0.709</td>
                                    <td>-0.500</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.746</td>
                                    <td>0.055</td>
                                    <td>-0.663</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>-0.443</td>
                                    <td>-0.703</td>
                                    <td>-0.557</td>
                                    <td>0.000</td>
                                </tr>
                                <tr>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>0.000</td>
                                    <td>1.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/jquery-3.1.1.min.js"></script>
    <script src="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/jquery-ui.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- <script src="../js/bootstrap.min.js"></script> -->
    <script src="./CS 4621_ Lecture 6 -- Exhibit #4_ Chaining 3D Transformations_files/gl-matrix-min.js"></script>
    <!-- Google Code Prettifier -->


    <script id="vertexShader" type="x-shader/x-vertex">
    attribute vec3 position;

    uniform mat4 toWorld;

    void main() {
        gl_Position = toWorld * vec4(position, 1.0);
    }
</script>

    <script id="fragmentShader" type="x-shader/x-fragment">
    precision highp float;

    uniform vec3 color;

    void main() {
        gl_FragColor = vec4(color, 1.0);
    }
</script>

    <script>
        var cubeData = {
            vertices: [
                -0.5, -0.5, -0.5,
                -0.5, -0.5, 0.5,
                -0.5, 0.5, -0.5,
                -0.5, 0.5, 0.5,
                0.5, -0.5, -0.5,
                0.5, -0.5, 0.5,
                0.5, 0.5, -0.5,
                0.5, 0.5, 0.5,
            ],
            lineInd: [
                0, 1, 0, 2, 0, 4, 1, 3, 1, 5, 2, 3, 2, 6, 4, 5, 4, 6, 6, 7, 5, 7, 3, 7
            ],
            triInd: [
            ],
            lineColor: [0.8, 0.8, 0.8],
            fillColor: [1.0, 0.9, 0.7]
        };

        function initGUI() {
            $('#transX').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
            $('#transY').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
            $('#transZ').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
            $('#rotX').spinner({ 'min': -360, 'max': 360, 'step': 5 });
            $('#rotY').spinner({ 'min': -360, 'max': 360, 'step': 5 });
            $('#rotZ').spinner({ 'min': -360, 'max': 360, 'step': 5 });
            $('#scaleX').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
            $('#scaleY').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
            $('#scaleZ').spinner({ 'min': -2, 'max': 2, 'step': 0.1 });
        }

        function displayMatrix4(sel, M) {
            $(sel).find('tr').each(function (i, elt) {
                $(elt).find('td').each(function (j, elt) {
                    $(elt).html(M[i + 4 * j].toFixed(3));
                });
            });
        }

        var xAxis = vec3.fromValues(1, 0, 0);
        var yAxis = vec3.fromValues(0, 1, 0);
        var zAxis = vec3.fromValues(0, 0, 1);

        function getMatrix() {
            var t = vec3.fromValues($('#transX').spinner('value'), $('#transY').spinner('value'), $('#transZ').spinner('value'));
            var T = mat4.create();
            mat4.fromTranslation(T, t);
            displayMatrix4('#transMatrix', T);

            var R = mat4.create();
            if ($('#orderXYZ').get(0).checked) {
                mat4.rotate(R, R, $('#rotX').spinner('value') * Math.PI / 180, xAxis);
                mat4.rotate(R, R, $('#rotY').spinner('value') * Math.PI / 180, yAxis);
                mat4.rotate(R, R, $('#rotZ').spinner('value') * Math.PI / 180, zAxis);
            } else {
                mat4.rotate(R, R, $('#rotZ').spinner('value') * Math.PI / 180, zAxis);
                mat4.rotate(R, R, $('#rotY').spinner('value') * Math.PI / 180, yAxis);
                mat4.rotate(R, R, $('#rotX').spinner('value') * Math.PI / 180, xAxis);
            }
            displayMatrix4('#rotMatrix', R);

            var s = vec3.fromValues($('#scaleX').spinner('value'), $('#scaleY').spinner('value'), $('#scaleZ').spinner('value'));
            var S = mat4.create();
            mat4.fromScaling(S, s);
            displayMatrix4('#scaleMatrix', S);

            var M = mat4.create();
            if ($('#orderTRS').get(0).checked) {
                mat4.mul(M, M, T);
                mat4.mul(M, M, R);
                mat4.mul(M, M, S);
            } else {
                mat4.mul(M, M, S);
                mat4.mul(M, M, R);
                mat4.mul(M, M, T);
            }
            displayMatrix4('#compMatrix', M);
            return M;
        }

        initGUI();

        function initializeWebGL(canvas) {
            // Getting WebGL context the right way
            var gl = null;
            try {
                gl = canvas[0].getContext("experimental-webgl");
                if (!gl) {
                    gl = canvas[0].getContext("webgl");
                }
            } catch (error) {
                // NO-OP
            }
            if (!gl) {
                alert("Could not get WebGL context!");
                throw new Error("Could not get WebGL context!");
            }
            return gl;
        }

        function createShader(gl, shaderScriptId) {
            var shaderScript = $("#" + shaderScriptId);
            var shaderSource = shaderScript[0].text;
            var shaderType = null;
            if (shaderScript[0].type == "x-shader/x-vertex") {
                shaderType = gl.VERTEX_SHADER;
            } else if (shaderScript[0].type == "x-shader/x-fragment") {
                shaderType = gl.FRAGMENT_SHADER;
            } else {
                throw new Error("Invalid shader type: " + shaderScript[0].type)
            }
            var shader = gl.createShader(shaderType);
            gl.shaderSource(shader, shaderSource);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                var infoLog = gl.getShaderInfoLog(shader);
                gl.deleteShader(shader);
                throw new Error("An error occurred compiling the shader: " + infoLog);
            } else {
                return shader;
            }
        }

        function createGlslProgram(gl, vertexShaderId, fragmentShaderId) {
            var program = gl.createProgram();
            gl.attachShader(program, createShader(gl, vertexShaderId));
            gl.attachShader(program, createShader(gl, fragmentShaderId));
            gl.linkProgram(program);
            gl.validateProgram(program);
            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                var infoLog = gl.getProgramInfoLog(program);
                gl.deleteProgram(program);
                throw new Error("An error occurred linking the program: " + infoLog);
            } else {
                return program;
            }
        }


        function createShape(gl, data) {
            var shape = {};

            shape.vertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, shape.vertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data.vertices), gl.STATIC_DRAW);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);

            shape.lineIndexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, shape.lineIndexBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data.lineInd), gl.STATIC_DRAW);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

            shape.triIndexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, shape.triIndexBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data.triInd), gl.STATIC_DRAW);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

            shape.lineLen = data.lineInd.length;
            shape.triLen = data.triInd.length;
            shape.lineColor = data.lineColor;
            shape.fillColor = data.fillColor;

            return shape;
        }

        function drawShape(gl, shape, program, xf) {
            gl.useProgram(program);

            gl.bindBuffer(gl.ARRAY_BUFFER, shape.vertexBuffer);
            var positionLocation = gl.getAttribLocation(program, "position");
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 3, gl.FLOAT, false, 4 * 3, 0);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);

            gl.uniformMatrix4fv(gl.getUniformLocation(program, "toWorld"), false, xf);

            gl.uniform3fv(gl.getUniformLocation(program, "color"), shape.fillColor);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, shape.triIndexBuffer);
            gl.drawElements(gl.TRIANGLES, shape.triLen, gl.UNSIGNED_SHORT, 0);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

            gl.uniform3fv(gl.getUniformLocation(program, "color"), shape.lineColor);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, shape.lineIndexBuffer);
            gl.drawElements(gl.LINES, shape.lineLen, gl.UNSIGNED_SHORT, 0);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);

            gl.useProgram(null);
        }

        function glEnv(canvas) {

            var gl = initializeWebGL(canvas);
            var program = createGlslProgram(gl, "vertexShader", "fragmentShader");
            var cat = createShape(gl, cubeData);

            var xf = mat4.create();
            function setXf(newXf) {
                mat4.copy(xf, newXf);
            }

            function drawFrame() {
                gl.clearColor(0.15, 0.2, 0.5, 1.0);
                gl.clear(gl.COLOR_BUFFER_BIT);

                drawShape(gl, cat, program, xf);
            }

            return {
                setXf: setXf,
                drawFrame: drawFrame
            }
        }

        var objSpaceEnv = glEnv($("#objCanvas"));
        var worldSpaceEnv = glEnv($("#worldCanvas"));

        function updateWebGL(time) {

            worldSpaceEnv.setXf(getMatrix());

            objSpaceEnv.drawFrame();
            worldSpaceEnv.drawFrame();

            // Reschedule the next frame.
            window.requestAnimationFrame(updateWebGL);
        }

        window.requestAnimationFrame(updateWebGL);

        var objCanvas = $("#objCanvas");

        objCanvas.click(function (event) {
        });
        objCanvas.mousemove(function (event) {
        });
    </script>


</body>

</html>